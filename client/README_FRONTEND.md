# Fizanakara — Frontend (client)

## Project Structure (important folders)
- `src/` — application source
  - `api/` — axios configuration and API helpers
  - `components/` — shared UI components and feature components
    - `shared/` — modals, management forms, etc.
    - `ui/` — small reusable UI primitives (Input, Button, Select, Alert...)
  - `context/` — React contexts (AuthContext)
  - `hooks/` — custom hooks using TanStack Query (useMembers, useAdmin, ...)
  - `lib/` — app utilities and types
    - `constant/` — static helpers for constants (images, etc.)
    - `helper/` — small helpers (date, validation, error formatting, string helpers)
    - `types/` — TypeScript models and enums
  - `services/` — thin wrappers around API endpoints (member.services, auth.service, ...)
  - `views/` — page-level views (Dashboard, Login, MemberManagement...)

## Helpers (src/lib/helper) — what exists and when to use
- `dateHelpers.ts`
  - `formatDate(date, format?)` — format dates for UI. Use for displays (lists, labels). Do NOT use for `input[type=date]` control values.
  - `calculateAge(birthDate)` — compute age from birth date.
  - `getDaysRemaining(dueDate)` — days until a date.

- `validationHelpers.ts`
  - `isValidPhoneNumber(phone)` — validate phone numbers (digits, min length).
  - `isValidImageUrl(url)` — validate image URLs and extensions.
  - `isValidEmail(email)` — email format validation.
  - `isValidBirthDate(date)` — ensures reasonable birth date.
  - `isNonEmpty(value)` — checks string non-empty after trim (added for bulk input validations).

- `errorHelpers.ts`
  - `getErrorMessage(error)` — canonicalize server / axios / Error objects into a user-friendly string.
  - `isNetworkError(error)` / `isAuthError(error)` — quick predicates for error handling.
  - `formatValidationErrors(zodErrors)` — normalize validation errors from schema validators.

- `stringHelpers.ts`
  - `getInitials(firstName, lastName)` — display initials (e.g. avatars).
  - `getFullName(firstName, lastName)` — formatted name.
  - `truncateText`, `formatSequenceNumber`, `toTitleCase` — misc formatting.

Use these helpers consistently:
- Replace inline `.trim()` checks and ad-hoc message building with `isNonEmpty`, `isValid*` and `getErrorMessage`.
- Use `formatDate` for human-facing date labels and `getInitials`/`getFullName` for name display.

## Authentication flow (as implemented in `api/axios.config.ts`)
- The app stores tokens in `localStorage`: `accessToken` and `refreshToken`.
- `api` is an axios instance with request interceptor that injects `Authorization: Bearer <accessToken>` if present.
- `api` has a response interceptor that attempts an automatic refresh when a `401` is received:
  1. On 401, the interceptor checks `_retry` flag on the original request.
  2. If not retried yet, it sends a POST to `/refresh` with `refreshToken`.
  3. On success it updates `accessToken` in `localStorage`, sets Authorization header, and retries the original request.
  4. On refresh failure it clears tokens and redirects to `/login`.

Important notes:
- Do NOT change `VITE_API_BASE_URL` in code; set the environment variable in Render or your environment instead.
- `input[type=date]` expects `YYYY-MM-DD` values — use `new Date().toISOString().split('T')[0]` for defaults and `formatDate` only for display.

## Mutation & Error handling conventions
- Use TanStack Query mutation `.mutateAsync(...)` when awaiting results in components (allows try/catch and linear control flow).
- Use `getErrorMessage(error)` from `errorHelpers` inside `catch` blocks to present user-friendly messages via `toast` or `Alert`.
- Show success toasts consistently on mutation `onSuccess` handlers in hooks (the `use*` hooks already do this).

## Quick Commands
- Start dev server:

```bash
cd client
npm install
npm run dev
```

- Build for production:

```bash
cd client
npm run build
```

## Troubleshooting (Render & common issues)
- CORS / 401 on Render: Ensure `VITE_API_BASE_URL` points to the correct backend URL and that backend CORS includes the frontend origin.
- Missing env var: The code falls back to `https://fizanakara-application.onrender.com` if `VITE_API_BASE_URL` is not set — check Render env settings.
- Token/Refresh loop: If refresh endpoint fails, tokens are removed and the user is redirected to `/login`.
- Build issues: Run `npm run build` locally to reproduce. Check console output for missing environment variables or type errors.

If you want, I can:
- Run a full grep sweep to ensure all `.mutate(` usages are updated or wrapped, and replace remaining manual validations.
- Generate a short changelog of modified files.

---
Generated by automated frontend audit & refactor (concise). Keep me posted for additional strict typing or wider refactors.
